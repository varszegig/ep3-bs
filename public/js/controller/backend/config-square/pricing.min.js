$(document).ready((function(){$("#pricing-table").on("click",".pricing-date-range-new",(function(event){event.preventDefault();var template=$("#pricing-table-template").html();$(this).closest("table").find("tr:last").before("<tr><td>"+template+"</td></tr>"),$(this).closest("table").find("tr:last").siblings("tr:last").hide().fadeIn(),$(".datepicker").datepicker()})),$("#pricing-table").on("click",".pricing-day-range-new",(function(event){event.preventDefault(),console.log(this);var template=$("#pricing-table-template").find(".pricing-day-range").closest("table").closest("td").html();$(this).closest(".pricing-table-day-range").children().children().last().after("<tr><td>"+template+"</td></tr>"),$(this).closest(".pricing-table-day-range").children().children().last().hide().fadeIn()})),$("#pricing-table").on("click",".pricing-time-range-new",(function(event){event.preventDefault();var template=$("#pricing-table-template").find(".pricing-time-range").closest("tr").closest("td").html();$(this).closest("table").find("tr:last").after("<tr><td>"+template+"</td></tr>"),$(this).closest("table").find("tr:last").siblings("tr:last").hide().fadeIn()})),$("#pricing-table").on("click",".pricing-price-new",(function(event){event.preventDefault();var template=$("#pricing-table-template").find(".pricing-price").closest("tr").html();$(this).closest("table").find("tr:last").after("<tr>"+template+"</tr>"),$(this).closest("table").find("tr:last").siblings("tr:last").hide().fadeIn(),$(".tooltip").tooltip()})),$("#pricing-table").on("click",".pricing-delete",(function(event){event.preventDefault();var fadeTime=200;$(this).closest("tbody").children("tr").length>2?$(this).closest("tr").fadeOut(200,(function(){$(this).remove()})):$(this).parents("tbody:eq(2)").children("tr").length>2?$(this).parents("tr:eq(2)").fadeOut(200,(function(){$(this).remove()})):$(this).parents("tbody:eq(4)").children("tr").length>2?$(this).parents("tr:eq(4)").fadeOut(200,(function(){$(this).remove()})):$(this).parents("tr:eq(6)").fadeOut(200,(function(){$(this).remove()}))})),$("#pricing-save").on("click",(function(event){$("#pricing-form-rules input").remove();var i=0;$("#pricing-table .pricing-price").each((function(index,element){var pricing=$(element),timeRange=pricing.parents("tbody:eq(1)").find(".pricing-time-range"),dayRange=timeRange.parents("tbody:eq(2)").find(".pricing-day-range"),dateRange=dayRange.parents("tbody:eq(2)").find(".pricing-date-range"),dateStart=dateRange.find("input.datepicker:first").val(),dateEnd=dateRange.find("input.datepicker:last").val(),dayStart=dayRange.find("select:first").val(),dayEnd=dayRange.find("select:last").val(),timeStart=timeRange.find("input.timepicker:first").val(),timeEnd=timeRange.find("input.timepicker:last").val(),price=pricing.find("input.pricepicker").val(),gross=pricing.find("select.pricing-rate-gross").val(),rate=pricing.find("input.pricing-rate").val(),priority=index,sid=pricing.find("select:last").val(),timeBlock=pricing.find("input.timeblockpicker").val();if(!dateStart.match(/^(0[1-9]|[1-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.[0-9]{4}$/))return window.alert('Hinweis: Das Datum "'+dateStart+'" ist ungültig - Format: 24.12.2014'),void event.preventDefault();if(!dateEnd.match(/^(0[1-9]|[1-2][0-9]|3[0-1])\.(0[1-9]|1[0-2])\.[0-9]{4}$/))return window.alert('Hinweis: Das Datum "'+dateEnd+'" ist ungültig - Format: 24.12.2014'),void event.preventDefault();if(timeStart.match(/^[0-9]{0,1}[0-9]$/)&&(timeStart+=":00"),!timeStart.match(/^[0-9]{0,1}[0-9]:[0-9][0-9]$/))return window.alert('Hinweis: Die Uhrzeit "'+timeStart+'" ist ungültig - Format: 23:15'),void event.preventDefault();if(timeEnd.match(/^[0-9]{0,1}[0-9]$/)&&(timeEnd+=":00"),!timeEnd.match(/^[0-9]{0,1}[0-9]:[0-9][0-9]$/))return window.alert('Hinweis: Die Uhrzeit "'+timeEnd+'" ist ungültig - Format: 23:15'),void event.preventDefault();if(price.match(/^[0-9]+$/)&&(price+=",00"),!price.match(/^[0-9]+,[0-9][0-9]$/))return window.alert('Hinweis: Der Preis "'+price+'" ist ungültig - Format: 19,95'),void event.preventDefault();if(!timeBlock.match(/^[1-9][0-9]*$/))return window.alert('Hinweis: Die Minutenangabe "'+timeBlock+'" ist ungültig'),void event.preventDefault();var data=JSON.stringify([sid,priority,dateStart,dateEnd,dayStart,dayEnd,timeStart,timeEnd,price,rate,gross,timeBlock]);$("#pricing-form-rules").append('<input type="hidden" name="pricing-rule-'+index+'" value="'+encodeURI(data)+'">'),i++})),$("#pricing-rules-count").val(i)}));var pricingRules=window.pricingRules,latestStartEndDate,latestStartEndDay,latestStartEndTime;$.each(pricingRules,(function(index,element){var sid=element[1],dateStart=element[3],dateEnd=element[4],dayStart=element[5],dayEnd=element[6],timeStart=element[7],timeEnd=element[8],price=element[9],rate=element[10],gross=element[11],timeBlock=element[12];sid||(sid="null");var thisStartEndDate=""+dateStart+dateEnd,thisStartEndDay=""+dayStart+dayEnd,thisStartEndTime=""+timeStart+timeEnd;if(thisStartEndDate!==latestStartEndDate){var template=$("#pricing-table-template").html();$("#pricing-table").find("tr:last").before("<tr><td>"+template+"</td></tr>")}else if(thisStartEndDay!==latestStartEndDay){var template=$("#pricing-table-template").find(".pricing-day-range").closest("table").closest("td").html();$("#pricing-table").find(".pricing-day-range:last").parents("tbody:eq(1)").find("tr:last").before("<tr><td>"+template+"</td></tr>")}else if(thisStartEndTime!==latestStartEndTime){var template=$("#pricing-table-template").find(".pricing-time-range").closest("table").closest("td").html();$("#pricing-table").find(".pricing-time-range:last").parents("tbody:eq(1)").find("tr:last").before("<tr><td>"+template+"</td></tr>")}else{var template=$("#pricing-table-template").find(".pricing-price").html();$("#pricing-table").find(".pricing-price:last").parents("tbody:eq(1)").find("tr:last").before('<tr><td class="pricing-price">'+template+"</td></tr>")}price=price>=100?price.substring(0,price.length-2)+","+price.substring(price.length-2):price>=10?"0,"+price:"0,0"+price,$("#pricing-table .pricing-dateStart:last").val(dateStart),$("#pricing-table .pricing-dateEnd:last").val(dateEnd),$("#pricing-table .pricing-dayStart:last").val(dayStart),$("#pricing-table .pricing-dayEnd:last").val(dayEnd),$("#pricing-table .pricing-timeStart:last").val(timeStart.substring(0,5)),$("#pricing-table .pricing-timeEnd:last").val(timeEnd.substring(0,5)),$("#pricing-table .pricing-price-number:last").val(price),$("#pricing-table .pricing-rate-gross:last").val(gross),$("#pricing-table .pricing-rate:last").val(rate),$("#pricing-table .pricing-sid:last").val(sid),$("#pricing-table .pricing-timeBlock:last").val(Math.round(timeBlock/60)),latestStartEndDate=thisStartEndDate,latestStartEndDay=thisStartEndDay,latestStartEndTime=thisStartEndTime})),$(".datepicker").datepicker()}));